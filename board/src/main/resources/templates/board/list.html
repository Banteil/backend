<!DOCTYPE html>
<html lang="kr" layout:decorate="~{layouts/layout}">
  <div layout:fragment="content">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title fw-semibold mb-4">게시판</h5>

        <div class="row mb-3">
          <form
            th:action="@{/board/list}"
            method="get"
            id="searchForm"
            class="d-flex"
            onsubmit="return validateSearch();"
          >
            <input
              type="hidden"
              name="page"
              id="searchPage"
              th:value="${requestDTO.page}"
            />
            <div class="col-md-2 me-2">
              <select name="type" class="form-select" id="searchType">
                <option value="">--- 검색 타입 ---</option>

                <option value="t" th:selected="${requestDTO.type == 't'}">
                  제목
                </option>
                <option value="a" th:selected="${requestDTO.type == 'a'}">
                  작성자
                </option>
              </select>
            </div>

            <div class="col-md-6 me-2">
              <input
                type="text"
                name="keyword"
                class="form-control"
                placeholder="검색어를 입력하세요."
                th:value="${requestDTO.keyword}"
                id="searchKeyword"
              />
            </div>

            <div class="col-md-2">
              <button type="submit" class="btn btn-primary w-100">검색</button>
            </div>
          </form>
        </div>
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th scope="col">번호</th>
                <th scope="col">제목</th>
                <th scope="col">작성자</th>
                <th scope="col">작성일</th>
              </tr>
            </thead>

            <tbody>
              <tr th:each="board, i : ${list}">
                <th
                  scope="row"
                  th:text="${result.totalCount - ((result.pageRequestDTO.page - 1) * result.pageRequestDTO.size + i.index)}"
                >
                  1
                </th>
                <td>
                  <a
                    th:href="@{/board/read(bno=${board.bno}, page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}"
                    th:text="${board.title} + (${board.replyCount > 0} ? ' [' + ${board.replyCount} + ']' : '')"
                    >제목입니다</a
                  >
                </td>

                <td th:text="${board.writerName}">홍길동</td>

                <td
                  th:text="${#temporals.format(board.createDateTime, 'yyyy-MM-dd HH:mm')}"
                >
                  2023-10-26 10:00
                </td>
              </tr>

              <tr th:if="${#lists.isEmpty(list)}">
                <td colspan="5" class="text-center">
                  등록된 게시글이 없습니다.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div
          th:replace="~{fragments/pagination :: paginationFragment(${result})}"
        ></div>

        <div class="mt-3 text-end">
          <a th:href="@{/board/insert}" class="btn btn-success">
            <i class="ti ti-plus me-1"></i> 새 게시글 등록
          </a>
        </div>
      </div>
    </div>
  </div>

  <th:block layout:fragment="script">
    <script th:inline="javascript">
      const resultMessage = /*[[${msg}]]*/ "default";
      if (resultMessage) {
        Swal.fire({
          title: resultMessage,
          icon: "success",
        });
      }

      function validateSearch() {
        const type = document.getElementById("searchType").value;
        const keyword = document.getElementById("searchKeyword").value.trim();
        const pageInput = document.getElementById("searchPage");

        if (type === "" && keyword === "") {
          return true;
        }

        if (type !== "" && keyword === "") {
          alert("검색어를 입력해주세요.");
          return false;
        }

        if (type === "" && keyword !== "") {
          alert("검색 타입을 선택해주세요.");
          return false;
        }

        if (type !== "" && keyword !== "") {
          pageInput.value = 1;
        } else {
          pageInput.disabled = true;
        }

        return true;
      }
    </script>
  </th:block>
</html>
